name: Build APK with h5pack

on:
  push:
    branches: ["main"]
  workflow_dispatch:

jobs:
  build-apk:
    runs-on: ubuntu-latest

    steps:
      # ... (æ­¥éª¤ 1 - 5 ä¿æŒä¸å˜)

      # 6. Run h5pack to build APK
      - name: Build APK
        run: npm run compress

      # ğŸ” æ–°å¢è¯Šæ–­æ­¥éª¤ï¼šæŸ¥æ‰¾ APK æ–‡ä»¶è·¯å¾„ (éå¸¸é‡è¦!)
      - name: Find APK File Path (Diagnosis)
        run: |
          echo "--- æ­£åœ¨æŸ¥æ‰¾æ‰€æœ‰ .apk æ–‡ä»¶ ---"
          # æŸ¥æ‰¾å¹¶æ‰“å°æ‰€æœ‰æ‰¾åˆ°çš„ .apk æ–‡ä»¶çš„å®Œæ•´è·¯å¾„
          find . -name "*.apk"
          echo "-------------------------------"

      # 7. Upload APK as GitHub Artifact
      - name: Upload APK Artifact
        uses: actions/upload-artifact@v4
        with:
          name: nav-app
          # ğŸš€ ä¼˜åŒ–åçš„è·¯å¾„ï¼šä½¿ç”¨é€šé…ç¬¦åŒ¹é…è¯¥ç›®å½•ä¸‹çš„æ‰€æœ‰ .apk æ–‡ä»¶
          # è¿™æ ·å¯ä»¥å¤„ç†æ–‡ä»¶åå¯èƒ½å­˜åœ¨çš„ç»†å¾®å˜åŒ– (ä¾‹å¦‚ï¼šllbug-v1.2.apk)
          path: 'nav-project/build/outputs/apk/debug/*.apk'
          
          # **æ³¨æ„:** å¦‚æœæ‚¨çš„ APK æ–‡ä»¶ä¸åœ¨å­æ–‡ä»¶å¤¹ä¸­ï¼Œè€Œæ˜¯ç›´æ¥åœ¨é¡¹ç›®æ ¹ç›®å½•çš„æŸä¸ªå·²çŸ¥æ–‡ä»¶å¤¹ï¼ˆä¾‹å¦‚ dist/ï¼‰ä¸­ï¼Œè¯·ç›¸åº”ä¿®æ”¹æ­¤è·¯å¾„ã€‚
          # æ¯”å¦‚ï¼špath: 'dist/*.apk'

          retention-days: 5